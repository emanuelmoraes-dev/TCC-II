\chapter{METODOLOGIA}
\label{Metodologia}

Este trabalho apresenta uma pesquisa de abordagem qualitativa, de natureza aplicada, visando amenizar os problemas de busca, junção e remoção em documentos normalizados, no banco de dados \textit{MongoDB}. Para isso, foi desenvolvido um \textit{framework} denominado de \textit{Alpha Restful}, que foi projetado para a linguagem \textit{JavaScript}, para o ambiente de execução \textit{Node JS}.

% O foco do \textit{MongoDB} é o armazenamento de dados desnormalizados, disponibilizando diversas funcionalidades para a sua manipulação. Por essa razão, operações de busca e junção de documentos normalizados precisam, as vezes, serem implementadas de forma menos intuitiva e mais trabalhosa, em comparação com o SQL. Visando amenizar os problemas apresentados, foi desenvolvido um \textit{framework} denominado de \textit{Alpha Restful}. Tal ferramenta foi projetada para a linguagem \textit{JavaScript}, no ambiente de execução \textit{Node JS}, utilizando internamente o \textit{MongoDB} e o \textit{Mongoose}.

O \textit{Alpha Restful} facilita e automatiza diversas funcionalidades para o desenvolvimento de aplicações com \textit{MongoDB}. Dentre as funcionalidades disponíveis nesse \textit{framework}, apenas cinco foram selecionadas e analisadas neste trabalho, pois tais \hl{funcionalidades} melhoram o processo de desenvolvimento de aplicações, através da manipulação de dados normalizados. \hl{As 5 funcionalidades selecionadas são: Junção de Documentos; Buscas Sobre Documentos Normalizados; Remoção em Cascata de Documentos; Relação de Dependência Entre os Documentos; e Remoção de Identificadores Inválidos.}

O estudo avalia, principalmente, a facilidade de desenvolver as cinco funcionalidades selecionadas, com o uso de algumas \hl{soluções} de mercado, em comparação com o \textit{framework} apresentado. Também é avaliado os recursos disponíveis nas ferramentas de mercado em comparação com o \textit{Alpha Restful}. Além da avaliação qualitativa, foi obtido um resultado quantitativo (para a funcionalidade Buscas Sobre Documentos Normalizados), onde pode ser observada uma redução na quantidade de linhas de código, com a utilização da solução proposta.

Foram utilizados procedimentos experimentais para a análise de cada funcionalidade. Para tal, codificações em \textit{JavaScript} foram desenvolvidas, a fim de extrair o quão fácil e intuitiva as implementações são. Além disso, pôde-se observar as particularidades de cada código, em relação aos conhecimentos técnicos necessários, sobre os comandos disponíveis na \hl{solução apresentada}.

Após a apresentação dos resultados alcançados pelos procedimentos realizados, a pesquisa objetiva caracterizar o \textit{Alpha Restful}, observando como ele apresenta melhorias para as situações apresentadas pelas outras \hl{soluções} comparadas. Além disso, objetiva-se demonstrar os recursos disponíveis no \textit{Alpha Restful}, destacando suas vantagens e utilidade.

\hl{Na prática, o \textit{Alpha Restful} funciona como uma camada acima do \textit{Mongoose}. Isto significa que toda a manipulação do banco é realizado pelo \textit{Mongoose}. O \textit{Alpha Restful} consegue abstrair diversas funcionalidades e, internamente, gerar diversos códigos fonte, graças ao objeto de sincronização (construído pelo programador) e os metadados gerados pelo \textit{framework}. A utilização do objeto de sincronização (\textit{sync}) e dos metadados (\textit{syncronized}) é apelidado de ``sincronização''.}

A sincronização é o estabelecimento de uma conexão lógica entre um atributo de uma entidade com outra entidade. Uma das formas de se estabelecer essa conexão é através do armazenamento de identificadores de outros documentos. Isso é equivalente ao uso de \textit{foreign key} no modelo relacional. Uma sincronização pode ocorrer, tanto na modelagem das entidades, quanto de forma dinâmica, depois de uma pesquisa.

Uma vez que duas entidades estão sincronizadas, diversas opções podem ser definidas no objeto ``\textit{sync}''. Cada uma delas aciona eventos que esperam uma das duas entidades serem chamadas por algum método presente no \textit{framework}. Tanto atributos reais (presentes no banco de dados) quanto atributos dinâmicos (não presentes no banco de dados, pois são criados dinamicamente em memória) podem ser alvo de uma sincronização. Um exemplo de atributo dinâmico será demonstrado na seção \ref{subsubsection: relacionamento-inverso}, quando for explicado o funcionamento do relacionamento inverso. Esses atributos dinâmicos são tratados como se eles existissem dentro do banco de dados, sendo possível utilizá-los em pesquisas. Esse tipo de atributo pode ser definido, tanto na modelagem da entidade, quanto dinamicamente na junção de documentos.

\hl{No objeto ``\textit{sync}'' está presente as informações passadas pelo programador, sobre as funcionalidades a serem aplicadas pelo \textit{framework}. Quando o método de busca é chamado, o \textit{Alpha Restful} percorre os objetos de sincronização, à medida que cada atributo de cada entidade é analisado. A pesquisa ocorre de maneira recursiva. Para tal, é realizado uma separação da pesquisa por ponto (``.''). Cada nome de atributo, obtido por meio dessa separação, gera um código de pesquisa que é utilizado na recurção anterior. O \textit{framework} utiliza as informações presentes no ``\textit{sync}'' para saber onde se encontram os outros atributos na entidade relacionada. A lógica dessa implementação, gerada internamente, é a mesma contida no exemplo} \ref{lst: busca-manual} \hl{do capítulo de resultados} (\ref{Resultados}).

\hl{A junção de documentos também ocorre de forma recursiva. Para tal, os atributos contidos nos objetos de sincronização são percorridos. Para cada atributo, a opção ``\textit{fill}'' é analisada, para saber se a entidade referente a esse atributo deve ser buscada e preenchida no atributo analisado. A recursão acaba, dependendo das opções disponíveis no objeto de sincronização, ou se não houver mais atributos a serem analisados.}

\hl{Para as funcionalidades referentes à remoção de entidades, o \textit{framework} utiliza os metadados contidos no objeto ``\textit{syncronized}''. Tal objeto é gerado automaticamente pelo \textit{framework}, baseado nos objetos de sincronização das entidades que se relacionam com a entidade analisada. Enquanto que o ``\textit{sync}'' descreve a sincronização a partir da entidade analisada, o ``\textit{syncronized}'' analisa a sincronização a partir das outras entidades. Graças a essa estratégia, as funcionalidades referentes a remoção de entidades é aplicada baseada em como as outras entidades definem o seu relacionamento com ela. As funcionalidades referentes a remoção de entidades são implementadas pelo método ``\textit{restful.deleteSync}''. Tal método deve ser chamado antes de uma entidade ser removida.}

\hl{A criação de \textit{schemas} no \textit{Alpha Restful} ocorre como uma mera interface para o \textit{Mongoose}. Isto significa que os dados contidos em \textit{``descriptor''} (definido na modelagem da entidade) é passado, tal qual como foi construído pelo programador, para a definição de \textit{schemas} do \textit{Mongoose}. Os dados contidos nesses \textit{schemas} também são analisados pelo \textit{framework}, apenas para a obtenção do tipo utilizado para cada atributo.}

Na seção seguinte (resultados), os exemplos e as comparações \hl{entre o \textit{Alpha Restful} e outras soluções de mercado} serão apresentados.

%%%%% REMOVIDO %%%%%
% A fim de demonstrar e justificar a importância da ferramenta desenvolvida, bem como demonstrar de que forma os problemas apresentados foram solucionados ou amenizados, o capítulo \ref{Resultados} apresenta um comparativo de como cada uma das 5 funcionalidades escolhidas podem ser implementadas com outras ferramentas já disponíveis no mercado, além de demonstrar quais os problemas ou dificuldades são enfrentadas usando tais ferramentas e como a utilização do \textit{Alpha Restful} pode resolver ou amenizar essas problemáticas. A fim de facilitar a apresentação do comparativo, na próxima seção será mostrado um conjunto de documentos exemplo que serão usados como base para explicar como cada funcionalidade pode manipular esses dados.
%%%%% REMOVIDO %%%%%

%diminuir as frases

%%%%% REMOVIDO %%%%%
% Para as duas primeiras funcionalidades, é apresentado, com a demonstração de exemplos práticos do código fonte, como outras ferramentas, presentes no \textit{MongoDB} ou no \textit{Mongoose}, podem ser utilizadas, bem como as vantagens e desvantagens de cada abordagem, demonstrando quais problemas são persistidos em cada uma delas. Após essa demonstração, será apresentado (também com a utilização de exemplos práticos de código fonte) como essa mesma função pode ser feita utilizando o \textit{Alpha Restful}, mostrando como o \textit{framework} resolve ou ameniza os problemas apresentados anteriormente, bem como quais opções a mais estão disponíveis por meio desta ferramenta. Para as demais funcionalidades, é apresentado uma breve descrição de como elas podem manualmente ser implementadas usando o \textit{MongoDB} e logo após é apresentado como é possível, através do \textit{Alpha Restful}, resolver tal necessidade de maneira mais automatizada.
%%%%% REMOVIDO %%%%%

% \footnote{Emanuel: lembrar que o trabalho já está pronto, então ao invés de usar termos como irá apresentar, irá mostrar, vc usa termos como apresenta, mostra, expõe}